{% extends "member/base.html" %}
{% load emarkdown %}
{% load email_obfuscator %}
{% load date %}
{% load profile %}
{% load crispy_forms_tags %}



{% block title %}
    {{ usr.username }}
{% endblock %}



{% block body_class %}content-cols{% endblock %}



{% block breadcrumb %}
    <li>{{ usr.username }}</li>
{% endblock %}



{% block content_out %}
    <section class="content-col-2">
        <h2>
            {{ usr.username }}
        </h2>

        <img src="{{ profile.get_avatar_url }}" alt="" class="avatar">

        {% include 'misc/badge.part.html' %}

        <p>
            Inscrit {{ usr.date_joined|format_date }}
        </p>
        <p>
            Dernière connexion {{ usr.last_login|format_date }}
        </p>
        {% if perms.member.show_ip %}
            <p>
                Dernière IP : {{ profile.last_ip_address }}
            </p>
            <p>
                Ville : {{ profile.get_city }}
            </p>
        {% endif %}

        {% if profile.show_email and user.is_authenticated %}
            <p>
                E-mail : <span class="fi-mail">{{ usr.email|obfuscate_mailto }}</span>
            </p>
        {% endif %}

        {% if profile.sign %}
            <h3>Signature</h3>
            {{ profile.sign|emarkdown }}
        {% endif %}


        {% if topics %}
            <h2>Dernier sujets crées</h2>
            {% for topic in topics %}
                <h4><a href="{{ topic.get_absolute_url }}">{{ topic.title }}</a></h4>
                <h5>{{ topic.subtitle }}</h5>
            {% endfor %}
        {% endif %}
    </section>



    <section class="content-col-2 tutorial-list">
        {% if tutorials %}
            <h2 class="ico-after ico-tutorials">Derniers tutoriels</h2>
            {% for tutorial in tutorials %}
                {% include 'tutorial/includes/tutorial_item.part.html' %}
            {% endfor %}
        {% endif %}


        {% if articles %}
            <h2 class="ico-after ico-articles">Derniers articles</h2>
            {% for article in articles %}
                {% include 'article/includes/article_item.part.html' %}
            {% endfor %}
        {% endif %}
    </section>



    {% if profile.biography %}
        <section class="full-content-wrapper">
            <h2>Biographie</h2>
            {{ profile.biography|emarkdown }}
        </section>
    {% endif %}



    {% if old_tutos and perms.member.change_profile %}
        <section class="full-content-wrapper">
            <h2>Anciens Tutos SdZ</h2>
            <table>
                <thead>
                    <tr>
                        <th>Tutoriel</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for id, titre in old_tutos %}
                        <tr>
                            <td>{{ titre }}</td>
                            <td>
                                <a href="#delete-old-tutorial-{{ id }}" class="btn btn-submit open-modal">Supprimer</a>
                                <div class="modal modal-small" id="delete-old-tutorial-{{ id }}">
                                    <p>
                                        Attention ! Vous êtes sur le point de supprimer le tutoriel "<em>{{ titre }}</em>".
                                    </p>
                                    <a href="{% url "zds.member.views.remove_oldtuto" %}?id={{ id }}&profile={{ profile.pk }}" class="btn btn-submit">Confirmer</a>
                                </div>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
    {% endif %}
{% endblock %}



{% block sidebar_actions %}
    {% ifequal profile.user user %}
        <div>
            <h3>Mon compte</h3>
            <ul>
                <li>
                    <a href="{% url "zds.member.views.settings_profile" %}" class="ico-after gear blue">
                        Paramètres
                    </a>
                </li>
            </ul>
        </div>
    {% endifequal %}

    {% if user.is_authenticated %}
        <div class="mobile-menu-bloc mobile-all-links" data-title="Actions">
            <h3>Actions</h3>
            <ul>
                <li>
                    <a href="{% url "zds.mp.views.new"%}?username={{ usr.username }}" class="ico-after cite blue">
                        Envoyer un message privé
                    </a>
                </li>
                {% if perms.member.change_profile %}
                    <li>
                        <a href="{% url "zds.member.views.settings_mini_profile" profile.user.username %}" class="ico-after edit blue">
                            Modifier le profil
                        </a>
                    </li>
                    <li>
                        <a href="#link-tuto-{{ profile.pk }}" class="open-modal ico-after tick green">
                            Attribuer un tuto SdZ
                        </a>
                        <div id="link-tuto-{{ profile.pk }}" class="modal modal-small">
                            <p>
                                Choisissez un tutoriel du SdZ à attribuer au membre.
                            </p>
                            {% crispy form %}
                        </div>
                    </li>
                {% endif %}
            </ul>
        </div>
    {% endif %}
{% endblock %}